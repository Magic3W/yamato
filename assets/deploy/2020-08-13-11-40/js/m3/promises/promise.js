(function(){function c(a){this._state=0;this._suitors=[];this._task=a;this._result=void 0;f(a)&&a(g(this.resolve,this),g(this.reject,this))}function k(a,b){this._success=h(a);this._failure=h(l(b));this._promise=new c}function f(a){return"function"===typeof a}function g(a,b){return function(){return a.apply(b,arguments)}}function h(a){return function(){return a?a.apply(void 0,arguments):null}}function l(a){return function(){if(!a)throw arguments[0];return a.apply(void 0,arguments)}}c.prototype.then=
function(a,b){a=new k(a,b);this._suitors.push(a);if(0!==this._state)try{a[1===this._state?"_success":"_failure"](this._result)}catch(d){a._promise.reject(d)}return a._promise};c.prototype["catch"]=function(a){return this.then(void 0,a)};c.prototype.reject=function(a){if(0===this._state)for(this._state=-1,this._result=a,a=0;a<this._suitors.length;a++)try{this._suitors[a]._failure(this._result)}catch(b){this._suitors[a]._promise.reject(b)}};c.prototype.resolve=function(a){if(a===this)throw new TypeError("A promise cannot resolve itself");
if(0===this._state)if(a instanceof c){var b=this;a.then(function(e){return b.resolve(e)},function(e){return b.reject(e)})}else{if(null!==a&&("object"===typeof a||f(a)))try{var d=a.then;if(f(d))return d.call(a,g(this.resolve,this),g(this.reject,this))}catch(e){this.reject(e)}return this.fulfill(a)}};c.prototype.fulfill=function(a){this._state=1;this._result=a;for(a=0;a<this._suitors.length;a++)if(f(this._suitors[a]._success))try{var b=this._suitors[a]._success(this._result),d=this._suitors[a]._promise;
setTimeout(function(){d.resolve(b)},0)}catch(m){var e=m;d=this._suitors[a]._promise;setTimeout(function(){d.reject(e)},0)}else this._suitors[a]._promise.resolve(this._result)};!1 in window&&(window.Promise=c);"depend"in window&&depend("m3/promises/promise",function(){return c});void 0===window.m3w&&(window.m3w={});window.m3w.Promise=c})();
